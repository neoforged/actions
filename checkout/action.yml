name: 'checkout'
description: 'Checkout a Pull Request and fetch tags'

runs:
  using: 'composite'
  steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 1000
        fetch-tags: true

    - name: Fetch tags # See https://github.com/actions/checkout/issues/2041
      shell: bash
      run: git fetch --tags

    # GradleUtils will append the branch name to the version,
    # but for that we need a properly checked out branch.
    # The branch name is lowercased so that the computed version is also lowercase
    # as Gradle doesn't love uppercase versions.
    - name: Create branch for commit (PR)
      if: ${{ github.event_name == 'pull_request' }}
      shell: bash
      run: |
        branch_name="${GITHUB_HEAD_REF:-${{ github.head_ref }}}"
        branch_name_lower=$(echo "$branch_name" | tr '[:upper:]' '[:lower:]')
        new_branch="pr-${{ github.event.pull_request.number }}-${branch_name_lower}"
        git switch -C "$new_branch"

    - name: Create branch for commit
      if: ${{ github.event_name != 'pull_request' }}
      shell: bash
      run:
        git switch -C ${{ github.ref_name }}